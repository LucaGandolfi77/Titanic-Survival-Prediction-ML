# ── Training Container ───────────────────────────
FROM python:3.11-slim

WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends \
    libgl1-mesa-glx libglib2.0-0 git && \
    rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

# Download pretrained weights
RUN python -c "from ultralytics import YOLO; YOLO('yolov8s.pt')"

# Default: generate data + train
CMD ["bash", "-c", "bash scripts/download_dataset.sh && bash scripts/train.sh s 100 16 cpu"]
