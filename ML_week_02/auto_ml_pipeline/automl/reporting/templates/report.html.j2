<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.min.css">
    <style>
        :root { --accent: #636efa; }
        body { max-width: 960px; margin: auto; padding: 2rem; font-family: system-ui, sans-serif; }
        h1 { color: var(--accent); border-bottom: 3px solid var(--accent); padding-bottom: .5rem; }
        h2 { margin-top: 2rem; }
        table { width: 100%; border-collapse: collapse; margin: 1rem 0; }
        th, td { padding: .5rem .75rem; border: 1px solid #ddd; text-align: left; }
        th { background: var(--accent); color: white; }
        tr:nth-child(even) { background: #f8f9fa; }
        .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
        .metric-card { background: #f0f2ff; border-radius: 8px; padding: 1rem; text-align: center; }
        .metric-card .value { font-size: 2rem; font-weight: 700; color: var(--accent); }
        .metric-card .label { font-size: .9rem; color: #555; }
        .chart-container { margin: 1.5rem 0; }
        footer { margin-top: 3rem; color: #888; font-size: .85rem; text-align: center; }
    </style>
</head>
<body>
    <h1>{{ title }}</h1>

    <p><strong>Task:</strong> {{ task }} &nbsp;|&nbsp;
       <strong>Dataset shape:</strong> {{ dataset_shape }}</p>

    <!-- Metrics -->
    <h2>Performance Metrics</h2>
    <div class="metric-grid">
        {% for key, val in metrics.items() %}
            {% if val is number %}
            <div class="metric-card">
                <div class="value">{{ "%.4f"|format(val) }}</div>
                <div class="label">{{ key }}</div>
            </div>
            {% endif %}
        {% endfor %}
    </div>

    <!-- Screening results -->
    {% if screening_table %}
    <h2>Model Screening</h2>
    <table>
        <thead>
            <tr><th>Model</th><th>Mean Score</th><th>Std</th><th>Time (s)</th></tr>
        </thead>
        <tbody>
        {% for row in screening_table %}
            <tr>
                <td>{{ row.model }}</td>
                <td>{{ "%.4f"|format(row.mean_score) }}</td>
                <td>{{ "%.4f"|format(row.std_score) }}</td>
                <td>{{ row.time_s }}</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <!-- Best params -->
    {% if best_params %}
    <h2>Best Hyper-parameters</h2>
    {% for model_name, params in best_params.items() %}
    <h3>{{ model_name }}</h3>
    <table>
        <thead><tr><th>Parameter</th><th>Value</th></tr></thead>
        <tbody>
        {% for k, v in params.items() %}
            <tr><td>{{ k }}</td><td>{{ v }}</td></tr>
        {% endfor %}
        </tbody>
    </table>
    {% endfor %}
    {% endif %}

    <!-- Feature importance -->
    {% if feature_importance_html %}
    <h2>Feature Importances</h2>
    <div class="chart-container">{{ feature_importance_html | safe }}</div>
    {% endif %}

    <!-- Confusion matrix -->
    {% if confusion_matrix_html %}
    <h2>Confusion Matrix</h2>
    <div class="chart-container">{{ confusion_matrix_html | safe }}</div>
    {% endif %}

    {% if ensemble_method %}
    <h2>Ensemble</h2>
    <p>Method: <strong>{{ ensemble_method }}</strong></p>
    {% endif %}

    <footer>Generated by AutoML-Lite</footer>
</body>
</html>
